<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发布信息</title>
    <link rel="stylesheet" href="../../app/css/bootstrap/3.3.0/bootstrap.min.css">
    <link rel="stylesheet" href="../../app/css/bootstrap/3.3.0/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../../app/css/publish.css"> 
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body> 
    <header class="clearfix">
        <div class="container">
            <div class="logo fl">
                <a href="#"><img src="../../app/image/logo.png" alt=""></a>
            </div>
            <div class="user_info fr">
                <p>HI，<span>Mango</span></p>
                <p><a href="#">退出登录</a></p>
            </div>
        </div>        
    </header> 

    <section class="main container clearfix">
        <aside class="menu_nav fl">
            <ul class="menu_nav_list">
                <li><i class="menu_nav_list_icon nav_icon_01"></i><a class="active" href="#">群发消息</a></li>
                <li><i class="menu_nav_list_icon nav_icon_02"></i><a href="#">留言管理</a></li>
                <li><i class="menu_nav_list_icon nav_icon_03"></i><a href="#">数据分析</a></li>
                <!--<li><i class="menu_nav_list_icon nav_icon_04"></i><a href="#">活动管理</a></li>-->
                <li><i class="menu_nav_list_icon nav_icon_05"></i><a href="#">素材管理</a></li>
                <!--<li><i class="menu_nav_list_icon nav_icon_06"></i><a href="#">营销插件</a></li>-->
                <li><i class="menu_nav_list_icon nav_icon_07"></i><a href="#">系统设置</a></li>
                <li class="menu_nav_list_bottom"><i class="menu_nav_list_icon nav_icon_bottom"></i></li>
            </ul>
        </aside> 

        
    </section>

    <script src="../../app/js/jquery/1.10.2/jquery.js"></script>
    <script src="../../app/js/bootstrap/3.3.0/bootstrap.min.js"></script>
    <script src="../../app/js/bootstrap/3.3.0/bootstrap-datetimepicker.min.js"></script>
    <script src="../../app/js/bootstrap/3.3.0/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="../../app/js/ueditor/1.4.3/ueditor.config.js"></script>
    <script src="../../app/js/ueditor/1.4.3/ueditor.all.min.js"></script>
    <script src="../../app/js/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script> 
       
    <script src="../../app/js/yunos.js"></script>    
    <!-- 实例化编辑器 -->
    <script type="text/javascript">
        $(function(){
            var interval,
                iFunctions = {};

            iFunctions = {
                init: function(){
        /*这里暂时放提示信息，提示上一次的工作点*/
        console.log("************************这里暂时放提示信息，提示上一次的工作点**************************");
        console.log("添加新图文后没有清空信息");


                    iFunctions.ueditorInit();
                    iFunctions.globalFuc();

                    //iFunctions.ImgTextList();
                    iFunctions.cunt_words();
                    iFunctions.add_voice();
                    iFunctions.change_type();
                    iFunctions.judge_emty();
                    iFunctions.show_question_detail();
                    iFunctions.add_calendar();
                    iFunctions.sel_date_html();
                    iFunctions.sel_daedline_html();
                    iFunctions.add_video();

                    iFunctions.choose_picture();
                    iFunctions.renderImgTextList();
                    iFunctions.edit_person();
                    iFunctions.add_vote();  
                },
                globalFuc: function(){
                    /*刷新或离开此页函数*/
                   /* window.addEventListener("beforeunload", function(e) {
                      var confirmationMessage = "";
                      (e || window.event).returnValue = confirmationMessage; // Gecko and Trident
                      return confirmationMessage; // Gecko and WebKit
                    }); */                
                },
                ueditorInit: function(){
                    var ue = UE.getEditor('editor', {                         
                        initialContent: '<span style="color:#bbb;">从这里开始写正文</span>',
                        autoClearinitialContent: true,
                        elementPathEnabled: false,
                        wordCount: false,
                        saveInterval: 500           
                    });

                    ue.ready(function() {//编辑器初始化完成再赋值                      
                        setDisabled(); 
                        insertTitle();

                        iFunctions.add_editorImg();
                    });

                    ue.addListener('blur',function(){
                        //setDisabled(); 

                        clearInterval(interval);
                    });

                    ue.addListener('focus',function(){
                        setEnabled();

                        var editCont = UE.getEditor('editor').getContent();

                        /*定时保存内容*/
                        interval = setInterval(function(){

                            if(UE.getEditor('editor').getContent() != editCont){
                               
                                iFunctions.cacheMasonry({
                                    "title": $('.title .editor_input').val(),
                                    "index": sessionStorage.Index,                                    
                                    "author": $('.author .editor_input').val(),                                    
                                    "content": UE.getEditor('editor').execCommand( "getlocaldata" ),
                                    "order": $('.leftside_cont_list[index="'+sessionStorage.Index+'"]').index()+1                               
                                });
                            }

                            editCont = UE.getEditor('editor').getContent();
                        }, 500);
                                                
                    });

                    function insertTitle() {
                        var _insertHtml =  '<div class="title editor_input_box">' +
                                                '<input class="editor_input" type="text" name="title" placeholder="请在这里输入标题">' +
                                                '<em class="editor_counter title_string_count">0/64</em>' +
                                            '</div>' +
                                            '<div class="author editor_input_box">' +
                                                '<input class="editor_input" type="text" name="author" placeholder="请输入作者">' +
                                                '<em class="editor_counter author_string_count">0/8</em>' +
                                            '</div>';
                        
                        $('#edui1_iframeholder').before(_insertHtml);     
                        $('.title .editor_input').focus();

                        iFunctions.renderImgTextList();

                        sessionStorage.Index = sessionStorage.lastIndex = $('.leftside_cont_list').eq(0).attr('index');//始化定位                 

                        //以下编辑时都要实时保存
                        /*字数统计*/
                        $('.title .editor_input').on('keyup',function(){  
                            var self = this;

                            var imgTextIndex = sessionStorage.Index;//定位当前图文序号
//console.log(imgTextIndex);

                            $('.title .editor_input').countPlugin({
                                'el':'.title_string_count',
                                'max': 64,
                                'strs': $(self).val()
                            });

                            $.each($('.leftside_cont_list'), function(i,item){
                                if($(this).attr('index') == imgTextIndex) {
                                    $(this).find('.title').text($(self).val());
                                }
                            });                            

                            //setTimeout(function(){
                                iFunctions.cacheMasonry({
                                    "title": $(this).val(),
                                    "index": imgTextIndex,                                    
                                    "author": $('.author .editor_input').val(),                                    
                                    "content": UE.getEditor('editor').getContent(),
                                    "order": $('.leftside_cont_list[index="'+imgTextIndex+'"]').index()+1
                                });
                           //},500);
                        });   
                        /*字数统计*/
                        $('.author .editor_input').on('keyup',function(){
                            var self = this;

                            var imgTextIndex = sessionStorage.Index;//定位当前图文序号

                            $('.author .editor_input').countPlugin({
                                'el':'.author_string_count',
                                'max': 8,
                                'strs': $(this).val()
                            });

                            //setTimeout(function(){
                                iFunctions.cacheMasonry({
                                    "title": $('.title .editor_input').val(),
                                    "index": imgTextIndex,                                    
                                    "author": $(this).val(),                                    
                                    "content": UE.getEditor('editor').getContent(),
                                    "order": $('.leftside_cont_list[index="'+imgTextIndex+'"]').index()+1
                                });
                            //},500);
                        });                        

                        $('.leftside_cont_list').eq(0).trigger('click');//初始定位
                    }

                    function setDisabled() {
                        UE.getEditor('editor').setDisabled('fullscreen');
                    }

                    function setEnabled() {
                        UE.getEditor('editor').setEnabled();                    
                    }

                    /*原文链接显示与否*/
                    $('.origin_link_box label').on('click', function(){    
                        $('#origin_link').is(':checked') ? $('.origin_link_input').addClass('hide') : $('.origin_link_input').removeClass('hide');
                    });

                    /*摘要*/
                    //根据CharCode是否在ASCII码范围内来区分数字汉字                   
                    //var str="88美元23,欧<p>元</p>34.89人<sp民币";
                    /*var str="div>我需要的文字</div>";                        
                    
                    str = str.replace(/<[^>]+>/g,"");
                    console.log(str);*/
                },                
                renderEditorText: function(index){//加载图文数据
//console.log(index);
                    var dataArr = {},
                        _flag = false;

                    if(localStorage._oData){
                        //localStorage._oData="";
                        //console.log("有session");          

                        dataArr = JSON.parse(localStorage._oData);                        
                                        
                        dataArr.recordList.map(function(product,i){
                            if(product.index == index){   
/*console.log("恩恩");                        
console.log(product); */            
                                $('.title .editor_input').val(product.title);
                                $('.author .editor_input').val(product.author);
                                UE.getEditor('editor').setContent(product.content);
                                _flag = true;
                            } else {
                                /*$('.title .editor_input').val('');
                                $('.author .editor_input').val('');
                                UE.getEditor('editor').setContent('');*/
                            } 
                        });        
                    } 

                    if(!_flag) {
                        $('.title .editor_input').val('');
                        $('.author .editor_input').val('');
                        UE.getEditor('editor').setContent('');
                    }
                },
                renderImgTextList: function(){//加载本地图文列表
                    var dataArr = {},
                        _html = ''
                        _temp = '';
 //localStorage._oData="";

                    if(localStorage._oData && JSON.parse(localStorage._oData).recordList.length){
                        //localStorage._oData="";
                        //console.log("有session");          

                        dataArr = JSON.parse(localStorage._oData);                        
console.log(dataArr.recordList);                                    
                        dataArr.recordList.map(function(product,i){
                            //if(product.index == index){                           
                                /*product.title = items.title || product.title;
                                product.content = items.content || product.content;
                                product.author = items.author || product.author;
                                product.originLink = items.originLink || product.originLink;
                                product.keyword = items.keyword || product.keyword;
                                product.cover = items.cover || product.cover;
                                product.summary = items.summary || product.summary;
                                product.index = items.index || product.index; */  
                                var date = {
                                    "1": "一",
                                    "2": "二",
                                    "3": "三",
                                    "4": "四",
                                    "5": "五",
                                    "6": "六",
                                    "7": "七"
                                };
console.log(dataArr.recordList.length);
                                if(dataArr.recordList.length==1){
                                    _temp = '';
                                } else {
                                    if(product.order == 1){
                                        _temp = '<i class="icon_arrow_down" title="下移"></i>' +                                                
                                                '<i class="icon_del" title="删除"></i>';
                                    } else if(product.order == dataArr.recordList.length) {
                                        _temp = '<i class="icon_arrow_up" title="上移"></i>' +                                            
                                                '<i class="icon_del" title="删除"></i>';
                                    } else {
                                        _temp = '<i class="icon_arrow_up" title="上移"></i>' + 
                                                '<i class="icon_arrow_down" title="下移"></i>' +                                                    
                                                '<i class="icon_del" title="删除"></i>';
                                    }
                                    
                                }

                                _html += '<div class="leftside_cont_list '+(product.order == 1 ? "leftside_cont_list_first active" : "")+'" index="'+product.index+'" title="第'+date[product.order]+'篇图文">' +
                                                '<img class="cover" src="'+product.cover+'" alt="">' +
                                                '<p class="title">'+product.title+'</p>' +  
                                                '<div class="bac_operation">' +
                                                    _temp +
                                                '</div>' +   
                                            '</div>';
                           // } 
                        });  

                        $('.leftside_cont').append(_html);     
                        //$('.leftside_cont_list:eq(0)').addClass('active').end().trigger('click');  
                    } else {
                        _html = '<div class="leftside_cont_list leftside_cont_list_first active" index="1" title="第一篇图文">' +
                                        '<img class="cover" src="" alt="">' +
                                        '<p class="title">标题</p>' +  
                                        '<div class="bac_operation">' +
                                            //'<i class="icon_arrow_down" title="下移"></i>' +                                            
                                        '</div>' +   
                                    '</div>';

                        $('.leftside_cont').append(_html);
                        //$('.leftside_cont_list:eq(0)').trigger('click'); 
                    }                    

                    /*新增图文,最多七篇*/
                    $('#addnew_imgtext_btn').on('click', function(){
                        var len = $('.leftside_cont_list').length;

                        if(len>=7){
                            alert("最多添加七篇图文信息");
                            return false;
                        }
                        
                        var date = {
                            "1": "一",
                            "2": "二",
                            "3": "三",
                            "4": "四",
                            "5": "五",
                            "6": "六",
                            "7": "七"
                        };

                        var _html = '<div class="leftside_cont_list" index="'+(len+1)+'" title="第'+date[len+1]+'篇图文">' +
                                        '<img class="cover" src="" alt="">' +
                                        '<p class="title">标题</p>' +  
                                        '<div class="bac_operation">' +
                                            '<i class="icon_arrow_up" title="上移"></i>' +
                                            '<i class="icon_del" title="删除"></i>' +
                                        '</div>' +   
                                    '</div>';

                        $('.leftside_cont').append(_html);
                        
                        $('.leftside_cont_list:eq('+len+')').trigger('click');
                    });
                    
                    /*选定图文编辑,同时保存上一个图文的数据*/
                    $(document).on('click', '.leftside_cont_list', function(){
                        sessionStorage.lastIndex = sessionStorage.Index;//定位上一个编辑的图文
                        sessionStorage.Index = $(this).attr('index');//定位当前正在编辑的图文
/*console.log(sessionStorage.lastIndex);
console.log(sessionStorage.Index);*/
                        $(this).addClass('active').siblings().removeClass('active');

                        /*加载当前选定的图文数据*/
                        iFunctions.cacheImgText(sessionStorage.lastIndex);                        
                    });

                    /*删除图文,同时删除记录*/
                    $(document).on('click', '.bac_operation .icon_del', function(e){  
                        e.stopPropagation();

                        var _index = $(this).parents('.leftside_cont_list').attr('index'),
                            items = $(this).parents('.leftside_cont_list').nextAll();   
            //console.log(_index);                   
                        $(this).parents('.leftside_cont_list').remove();

                        $.each(items, function(i, item){
                            iFunctions.cacheMasonry({
                                "order": i+1
                            })
                        });

                        iFunctions.removeCacheMasonry(_index);
                    });

                    /*调整图文列表顺序*/
                    $(document).on('click', '.icon_arrow_down', function(){
                        var nextNode = $(this).parents('.leftside_cont_list').next();
console.log(nextNode);
                        if((nextNode.index()+1)==$('.leftside_cont_list').length) {
                            //$(this).parents('.leftside_cont_list').
                        }

                        $(this).parents('.leftside_cont_list').insertAfter(nextNode);
                        //iFunctions.cacheList();
                    });

                    $(document).on('click', '.icon_arrow_up', function(){
                        var preNode = $(this).parents('.leftside_cont_list').prev();
console.log(preNode);
                        $(this).parents('.leftside_cont_list').insertBefore(preNode);
                        //iFunctions.cacheList();
                    });
                },

                cunt_words: function () {
                    $(document).on('keyup','.video_text',function(){
                        var title_length=$(this).val().length;
                        if(title_length<21){
                            $('.cout_words em').text(title_length);
                        } else{
                            $('.cout_words em').text(21);
                            $('.video_text').val($('.video_text').val().substring(0,21));
                        }
                    })
                },
                add_editorImg: function(){
                    $('.pic_comfirm').on('click', function(){
                        var $img = $('.choose_picture img:first');
console.log($img);
                        UE.getEditor('editor').execCommand('insertHtml', value);
                    }); 
                },

                add_voice: function () {
                    $(document).on('click','.addvoice_btn',function(){
                        $('.voice_body').addClass('hide');
                        $('.addnew_voice').removeClass('hide');
                    })
                },

                change_type: function () {
                    $(document).on('click','.voice_tittle',function(){
                        $('.voice_tittle').removeClass('active');
                        $(this).addClass('active');
                        var bID = $(this).attr('data-showaudio');
                        //$('.modal-body').addClass('hidden');
                        $(bID).removeClass('hide').siblings('.modal-body').addClass('hide');
                    })

                    $(document).on('click','.video_tittle',function(){
                        $('.video_tittle').removeClass('active');
                        $(this).addClass('active');
                        var vID = $(this).attr('data-showvideo');
                        //$('.modal-body').addClass('hidden');
                        $(vID).removeClass('hide').siblings('.modal-body').addClass('hide');
                    })

                    $(document).on('click','.n_vidio_left_item',function(){
                        var bID = $(this).attr('data-change')
                        $('.n_vidio_right_item').addClass('hidden');
                        $(bID).removeClass('hidden');
                    })
                },

                judge_emty: function () {

                    //投票名称
                    $(document).on('blur','#vote_name',function(){
                        var vote_name=$('#vote_name').val();
                        if(vote_name==''|| vote_name==null){
                            $('.name_remind').removeClass('hide');
                        }
                    })
                    $(document).on('focus','#vote_name',function(){
                        $('.name_remind').addClass('hide');
                    })
                    //投票名称

                    //问题标题
                    $(document).on('blur','.question_tag',function(){
                        var vote_name=$(this).val();
                        if(vote_name==''|| vote_name==null){
                            $('.tittle_span').removeClass('hide');
                        }
                    })
                    $(document).on('focus','.question_tag',function(){
                        $('.tittle_span').addClass('hide');
                    })
                    //问题标题

                    //问题选项
                    $(document).on('blur','.option_text',function(){
                        var vote_name=$(this).val();
                        if(vote_name==''|| vote_name==null){
                            $(this).parent().find('.option_span').removeClass('hide');
                        }
                    })
                    $(document).on('focus','.option_text',function(){
                        $(this).parent().find('.option_span').addClass('hide');
                    })
                    //问题选项
                },

                show_question_detail: function () {
                    $(document).on('click','.question_edit',function(){
                        if($(this).parent().next().hasClass('hide')){
                            $(this).text('收起');
                            $(this).parent().next().removeClass('hide');
                        }else {
                            $(this).text('编辑');
                            $(this).parent().next().addClass('hide');
                        }
                    })
                },

                add_question: function () {
                    $(document).on('click','.add_question span',function(){

                    })
                },

                add_calendar: function () {
                    $(".form-control").datetimepicker({
                        format: "yyyy-mm-dd",
                        autoclose: true,                
                        language:'zh-CN',
                        pickerPosition:"bottom-left",
                        minView: 2
                    });
                },

                sel_date_html: function () {
                    $('.select').on('click','.select_text',function(e){                        
                        $(this).next().toggleClass('hidden');
                        e.stopPropagation();
                    })
                    $('.select').on('click','.select_list_item',function(e){
                        e.stopPropagation();
                        var select_list_item=$(this).text();
                        $(this).parents('.select_list').prev().text(select_list_item);
                        $(this).parents('.select_list').addClass('hidden');
                    })
                    $('.select').on('mouseover','.select_list_item',function(e){
                        $(this).css('background','#4ea1eb');
                        $(this).css('color','#fff');
                    })
                    $('.select').on('mouseout','.select_list_item',function(e){
                        $(this).css('background','#fff');
                        $(this).css('color','#222222');
                    })
                    $('.select').on('mouseout','.use_list .select_list_item',function(e){
                        $(this).css('background','#fff');
                        $(this).css('color','#bbbbbb');
                    })
                    $(document).on('mouseleave','.select_list',function(){
                        $(this).addClass('hidden');
                    })
                    $('body').click(function(){
                        $('.select_list').addClass('hidden');
                    })
                    for(var i=0;i<=59;i++){
                        $('.mini').append('<li class="select_list_item select_list_min_item" min="'+i+'">'+i+'分'+'</li>'); 
                    }
                    for(var j=0;j<=23;j++){
                        $('.min').append('<li class="select_list_item select_list_hour_item" hour="'+j+'">'+j+'时'+'</li>'); 
                    }  

                    $(document).on('click', '.select_list_min_item', function(){
                        $('.sel_minutes').attr('data-minute',$(this).attr('min'));
                    });   

                    $(document).on('click', '.select_list_hour_item', function(){
                        $('.sel_hours').attr('data-hour',$(this).attr('hour'));
                    });                                      
                },

                sel_daedline_html: function () {
                    $('.select').on('click','.d_select_text',function(e){                        
                        $(this).next().toggleClass('hidden');
                        e.stopPropagation();
                    })
                    $('.select').on('click','.d_select_list_item',function(e){
                        e.stopPropagation();
                        var select_list_item=$(this).text();
                        $(this).parents('.d_select_list').prev().text(select_list_item);
                        $(this).parents('.d_select_list').addClass('hidden');
                    })
                    $(document).on('mouseleave','.d_select_list',function(){
                        $(this).addClass('hidden');
                    })
                    $('body').click(function(){
                        $('.d_select_list').addClass('hidden');
                    })
                    for(var i=0;i<=59;i++){
                        $('.d_mini').append('<li class="d_select_list_item d_select_list_min_item" min="'+i+'">'+i+'分'+'</li>'); 
                    }
                    for(var j=0;j<=23;j++){
                        $('.d_min').append('<li class="d_select_list_item d_select_list_hour_item" hour="'+j+'">'+j+'时'+'</li>'); 
                    }  

                    $(document).on('click', '.d_select_list_min_item', function(){
                        $('.d_sel_minutes').attr('data-minute',$(this).attr('min'));
                    });   

                    $(document).on('click', '.d_select_list_hour_item', function(){
                        $('.d_sel_hours').attr('data-hour',$(this).attr('hour'));
                    }); 
                },

                add_video: function () {
                    /*字数统计*/
                    $(document).on('keyup','.add_video_tittle',function(){
                        var title_length=$(this).val().length;
                        if(title_length<21){
                            $('.tittle_count').text(title_length);
                        } else{
                            $('.tittle_count').text(21);
                            $('.add_video_tittle').val($('.add_video_tittle').val().substring(0,21));
                        }
                    })
                    $(document).on('keyup','#video_area',function(){
                        var video_area_length=$(this).val().length;
                        if(video_area_length<200){
                            $('.area_count em').text(video_area_length);
                        } else{
                            $('.area_count em').text(200);
                            $('#video_area').val($('#video_area').val().substring(0,200));
                        }
                    })
                    $(document).on('click','.agree_check',function(){
                        if($('.agree_check').is(':checked')){
                            $('.add_sure_btn').addClass('sure_active');
                        } else{
                            $('.add_sure_btn').removeClass('sure_active');
                        } 
                    })
                    //添加视频弹窗的提示
                    $(document).on('mouseover','.format',function(){
                        $('.format_box').removeClass('hidden');
                    })
                    $(document).on('mouseout','.format',function(){
                        $('.format_box').addClass('hidden');
                    })
                    
                    $(document).on('mouseover','.remind_img',function(){
                        $('.tag_box').removeClass('hidden');
                    })
                    $(document).on('mouseout','.remind_img',function(){
                        $('.tag_box').addClass('hidden');
                    })

                    $(document).on('mouseover','.remind_imgs',function(){
                        $('.cover_box').removeClass('hidden');
                    })
                    $(document).on('mouseout','.remind_imgs',function(){
                        $('.cover_box').addClass('hidden');
                    })

                    $(document).on('mouseover','.process',function(){
                        $('.process_box').removeClass('hidden');
                    })
                    $(document).on('mouseout','.process',function(){
                        $('.process_box').addClass('hidden');
                    })
                },

                add_vote: function () {
                    $(document).on('click','.del_span',function(){
                        $(this).parents('.question_item').remove();
                    });

                    $(document).on('click','.add_span',function(){
                        var i =$(this).prev().find('.question_label').text();
                        var j = parseInt(i.substring(2))+1;
                        console.log(j);

                        var question_html='<div class="question_item clearfix">'
                                                +'<label for="question_choose_01" class="question_label fl">选项'+ j +'</label>'
                                                +'<input type="text" class="question_text option_text fl" id="question_choose_01">'
                                                +'<span class="cout_question_tittle"><em>0</em>/35</span>'
                                                +'<span class="remind_span del_span">删除选项</span>'
                                                +'<span class="remind_kong_span option_span hide">请填写问题的选项</span>'
                                            +'</div>';
                        $(this).prev().after(question_html);
                    });

                    $(document).on('click','.add_question_box',function(){
                        var question_text=$(this).parents('.new_vote_box').prev().find('.question_text').val();
                        var question_select=$(this).parents('.new_vote_box').prev().find('.select_btn:checked').val();
                        var q_html='<div class="new_vote_box vote_question fl">'
                                        +'<div class="big_question_box">'
                                            +'<div class="question_box">'
                                                    +'问题<em>1</em>'
                                                +'<i class="fr question_edit">编辑</i>'
                                                +'<span class="fr hide remind_red">问题填写完整才能添加下一个问题</span>'
                                            +'</div>'
                                            +'<div class="question_box_item hide">'
                                                +'<div class="question_form">'
                                                    +'<div class="question_item clearfix">'
                                                        +'<label for="question_tag" class="question_label fl">标题</label>'
                                                        +'<input type="text" class="question_text question_tag fl" id="question_tag">'
                                                        +'<span class="remind_kong_span tittle_span hide">请填写问题的标题</span>'
                                                        +'<span class="cout_question_tittle"><em>0</em>/35</span>'
                                                    +'</div>'
                                                    +'<div class="question_item clearfix select_type">'
                                                        +'<div class="choose_box fl">'
                                                            +'<input type="radio" class="select_btn" id="one_select" name="select_item">'
                                                            +'<label for="one_select" class="select_btn_label"></label>'
                                                            +'<span>单选</span>'
                                                        +'</div>'
                                                        +'<div class="choose_box fl">'
                                                            +'<input type="radio" class="select_btn" id="multi_select" name="select_item">'
                                                            +'<label for="multi_select" class="select_btn_label"></label>'
                                                            +'<span>多选</span>'
                                                        +'</div>'
                                                    +'</div>'
                                                    +'<div class="question_item clearfix">'
                                                        +'<label class="question_label fl">选项1</label>'
                                                        +'<input type="text" class="question_text option_text fl">'
                                                        +'<span class="remind_kong_span option_span hide">请填写问题的选项</span>'
                                                        +'<span class="cout_question_tittle"><em>0</em>/35</span>'
                                                    +'</div>'
                                                    +'<div class="question_item clearfix">'
                                                        +'<label class="question_label fl">选项2</label>'
                                                        +'<input type="text" class="question_text option_text fl">'
                                                        +'<span class="remind_kong_span option_span hide">请填写问题的选项</span>'
                                                        +'<span class="cout_question_tittle"><em>0</em>/35</span>'
                                                    +'</div>'
                                                    +'<div class="question_item clearfix">'
                                                        +'<label class="question_label fl">选项3</label>'
                                                        +'<input type="text" class="question_text option_text fl">'
                                                        +'<span class="cout_question_tittle"><em>0</em>/35</span>'
                                                        +'<span class="remind_span del_span">删除选项</span>'
                                                        +'<span class="remind_kong_span option_span hide">请填写问题的选项</span>'
                                                    +'</div>'
                                                    +'<div class="remind_span add_span">添加选项</div>'
                                                    +'<div class="line"></div>'
                                                +'</div>'
                                            +'</div>'
                                        +'</div>'
                                    +'</div>';
                        if(question_text==''||question_text==null||question_select==''||question_select==null){
                            $(this).parents('.new_vote_box').prev().find('.remind_red').removeClass('hide');
                            $(this).parent().next().removeClass('hide');
                        } else{
                            $(this).parents('.new_vote_box').prev().find('.remind_red').addClass('hide');
                            $(this).parent().next().addClass('hide');
                            $(this).parents('.new_vote_box').before(q_html);
                            var _id=$(this).parents('.new_vote_box').siblings('.vote_question').find('.select_btn').attr('data-id');
                            var id_num=_id+1;
                            var change_id=$(this).parents('.new_vote_box').siblings('.vote_question').find('.select_btn').attr("id",'one_select'+id_num);
                            console.log(_id);
                        }
                    })
                },

                edit_person: function () {
                    $(document).on('click','.edit_btn',function(){
                        $(this).parent().addClass('hide');
                        $(this).parent().next().removeClass('hide');
                    })
                },

                choose_picture: function () {
                    $(document).on('click','.choose_picture',function(){
                        $(this).children('.choosen').toggleClass('hide');
                        $(this).toggleClass('sel');
                    })
                }, 

                

                    /**/
                
                cacheImgText: function(index){//保存图文的数据
                    iFunctions.cacheMasonry({
                        "title": $('.title .editor_input').val(),
                        "author": $('.author .editor_input').val(),
                        "index": index,
                        "content": UE.getEditor('editor').getContent()
                    });

                },   


                
                cacheImgText: function(index){//保存图文的数据    
    /*console.log("标题");
    console.log($('.title .editor_input').val());
    console.log("作者");
    console.log($('.author .editor_input').val());
    console.log("标记ID");
    console.log(index);
    console.log("内容");
    console.log(UE.getEditor('editor').getContent());*/

                    if(sessionStorage.lastIndex != sessionStorage.Index) {                        
                        iFunctions.cacheMasonry({
                            "title": $('.title .editor_input').val(),
                            "author": $('.author .editor_input').val(),
                            "index": index,
                            "content": UE.getEditor('editor').getContent(),
                            "order": $('.leftside_cont_list[index="'+index+'"]').index()+1
                        });
                    }                    


                    iFunctions.renderEditorText(sessionStorage.Index);
                },
                cacheList: function(){//localStorage存储图文数据列表（按顺序）
                    //
                    if(localStorage._oData){
                        dataArr = JSON.parse(localStorage._oData); 

                        dataArr.recordList = sortByKey(dataArr.recordList, 'order');

                        localStorage._oData = JSON.stringify(dataArr);
console.log(localStorage._oData);
                    }

                    function sortByKey(array, key) {
                        return array.sort(function(a, b) {
                            var x = a[key]; var y = b[key];
                            return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                        });
                    }                   
                },                
                cacheMasonry: function(opt){//localStorage存储每一篇图文数据
                    var dataArr = {
                            "recordList": []
                        },                        
                        items = {},
                        _flag = false;   
console.log(opt);
                    items.title = opt.title;
                    items.content = opt.content;
                    items.author = opt.author;
                    items.originLink = opt.originLink;
                    items.keyword = opt.keyword;
                    items.cover = opt.cover;
                    items.summary = opt.summary;
                    items.index = opt.index;                      
                    items.order = opt.order;                      

                    if(localStorage._oData){
                        //localStorage._oData="";
                        //console.log("有session");
                        var exchangeOrder;          

                        dataArr = JSON.parse(localStorage._oData);                        
                                        
                        dataArr.recordList.map(function(product,i){
                            if(product.index == items.index){  
                                exchangeOrder = product.order;                         
                                product.title = items.title || product.title;
                                product.content = items.content || product.content;
                                product.author = items.author || product.author;
                                product.originLink = items.originLink || product.originLink;
                                product.keyword = items.keyword || product.keyword;
                                product.cover = items.cover || product.cover;
                                product.summary = items.summary || product.summary;
                                product.index = items.index || product.index;   
                                product.order = items.order || product.order;   
                                _flag = true;                        
                            }
                        });

                        dataArr.recordList.map(function(product,i){
                            if(items.order == product.order){  
                                product.order = exchangeOrder; 
                            }
                        });

                        if(!_flag) dataArr.recordList.push(items);  
                        localStorage._oData = JSON.stringify(dataArr);
            
                    } else {                    

                        dataArr.recordList.push(items);        
                        localStorage._oData = JSON.stringify(dataArr);
                    }  

//console.log(localStorage._oData);     
                },
                removeCacheMasonry: function(index){
//console.log(index);
                    if(localStorage._oData){
                        //localStorage._oData="";
                        //console.log("有session");          

                        dataArr = JSON.parse(localStorage._oData);                        
                                        
                        dataArr.recordList.map(function(product,i){
                            if(product.index == index){                           
                               dataArr.recordList.splice(i, 1);                    
                            }
                        });
                          
                        localStorage._oData = JSON.stringify(dataArr);
    console.log(localStorage._oData);            
                    }
                }
            }

            var publishFuc = (function(){
                iFunctions.init();
            })();
        });
        
    </script>
</body>
</html>
